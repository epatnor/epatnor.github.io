<!DOCTYPE html>
<html lang="sv">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Personnummer Växel med Logg</title>
    
    <!-- External CSS -->
    <link rel="stylesheet" href="style.css">
    
    <!-- Font Awesome for Icons -->
    <script src="https://kit.fontawesome.com/a076d05399.js" crossorigin="anonymous"></script>
</head>
<body class="light">
    <div class="container">
        <div class="theme-switch">
            <button id="theme-toggle"><i class="fas fa-sun"></i></button>
        </div>
        <h1><i class="fas fa-sync-alt"></i> Personnummer Växel</h1>
        <p>Här kan du se loggen för alla personnummerförfrågningar, både korrekta och felaktiga format:</p>
        <div class="log" id="log"></div>
    </div>

    <script>
        // Toggle light and dark theme
        const themeToggleBtn = document.getElementById('theme-toggle');
        const bodyElement = document.body;

        themeToggleBtn.addEventListener('click', () => {
            if (bodyElement.classList.contains('light')) {
                bodyElement.classList.replace('light', 'dark');
                themeToggleBtn.innerHTML = '<i class="fas fa-moon"></i>';
            } else {
                bodyElement.classList.replace('dark', 'light');
                themeToggleBtn.innerHTML = '<i class="fas fa-sun"></i>';
            }
        });

        // Log entries function
        function logEntry(original, formatted, isValid) {
            const logDiv = document.getElementById('log');
            const entryDiv = document.createElement('div');
            entryDiv.className = 'log-entry ' + (isValid ? 'valid' : 'invalid');
            entryDiv.innerHTML = `
                <i class="fas ${isValid ? 'fa-check-circle' : 'fa-times-circle'}"></i>
                <strong>Original:</strong> ${original} <br>
                <strong>Formaterat:</strong> ${formatted ? formatted : 'Ogiltigt personnummer'}
            `;
            logDiv.appendChild(entryDiv);
        }

        window.onload = function() {
            // Hämta personnummer från URL-parametern
            const urlParams = new URLSearchParams(window.location.search);
            let personnummer = urlParams.get('personnummer');

            if (!personnummer) {
                logEntry('Tomt värde', null, false);
                return;
            }

            const originalPersonnummer = personnummer; // Spara för loggning
            personnummer = personnummer.replace(/\D/g, '');

            let isValid = true;
            if (personnummer.length === 10) {
                // Lägg till prefix (t.ex. 19) för tvåsiffrigt århundrade
                personnummer = "19" + personnummer;
            }

            if (personnummer.length !== 12) {
                isValid = false;
            }

            let formateratPersonnummer = null;
            if (isValid) {
                // Lägg till streck innan de sista fyra siffrorna
                formateratPersonnummer = personnummer.slice(0, 8) + "-" + personnummer.slice(8);
            }

            // Logga händelsen
            logEntry(originalPersonnummer, formateratPersonnummer, isValid);

            if (isValid) {
                // Visa det formaterade personnumret på sidan istället för att skicka det
                const outputDiv = document.createElement('p');
                outputDiv.textContent = `Detta personnummer kommer skickas vidare: ${formateratPersonnummer}`;
                document.body.appendChild(outputDiv);
            }
        };
    </script>
</body>
</html>
