<!DOCTYPE html>
<html lang="sv">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Personnummer Konverterare</title>
    <link rel="stylesheet" href="style.css"> <!-- Om du har en extern CSS-fil -->
    <script src="personnummerValidator.js" defer></script> <!-- Ladda den externa JavaScript-filen -->
</head>
<body>
    <h1>Personnummer Konverterare</h1>
    <div id="log"></div>

    <script>
        window.onload = function() {
            const urlParams = new URLSearchParams(window.location.search);
            let personnummer = urlParams.get('personnummer');

            if (!personnummer) {
                logEntry('Tomt värde', null, false);
                return;
            }

            const originalPersonnummer = personnummer; // Spara för loggning
            const isValid = isValidPersonnummer(personnummer); // Anropa den separata funktionen

            let formateratPersonnummer = null;

            if (isValid) {
                // Ta bort allt utom siffror
                personnummer = personnummer.replace(/\D/g, ''); // Rensa bort icke-siffror

                // Kontrollera längd och format
                if (personnummer.length === 10) {
                    // 10 siffror: Lägg till 20xx eller 19xx baserat på ålder
                    const yearPrefix = personnummer.substring(0, 2) < "20" ? "20" : "19"; // Bestäm årtalet
                    personnummer = yearPrefix + personnummer; // Lägger till 20 eller 19
                }
                
                // Kontrollera att personnumret nu är 12 siffror
                if (personnummer.length === 12) {
                    formateratPersonnummer = personnummer.slice(0, 8) + "-" + personnummer.slice(8); // Format YYYYMMDD-XXXX
                }
                
                // Visa det formaterade personnumret på sidan
                const outputDiv = document.createElement('p');
                outputDiv.textContent = `Detta personnummer kommer skickas vidare: ${formateratPersonnummer}`;
                document.body.appendChild(outputDiv);
            } else {
                logEntry(originalPersonnummer, null, false);
            }

            // Logga händelsen
            logEntry(originalPersonnummer, formateratPersonnummer, isValid);
        };

        function logEntry(original, formatted, success) {
            const logDiv = document.getElementById('log');
            const logMessage = success
                ? `Framgång: ${original} -> ${formatted}`
                : `Misslyckande: ${original} - Ogiltigt personnummer`;
            logDiv.innerHTML += `<p>${logMessage}</p>`;
        }
    </script>
</body>
</html>
